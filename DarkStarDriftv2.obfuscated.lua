local h=ac.getDriverName()local Y=ac.getDriverName(0)local G=80 local t=5 local B=0 local f={}local i=nil local S=nil local e=300 local I=0 function script.prepare(Y)h=ac.getDriverName()ac.debug("\115\112\101\101\100",(ac.getCarState(1)).speedKmh)return(ac.getCarState(1)).speedKmh>60 end local q=0 local j=0 local K=1 local c=0 local P=0 local O=0 local C={}local v=0 local R=ac.getCarState(1)local F={}local H={}local L=0 local s=0 local Z=30 local w=1 local n=2 local x=0 local J=200 local y=5 local k=0 local A=vec2(50,50)local u=false local g="\072\069\065\068\069\082-\084\073\084\076\069"local p=true local d="\104\116\116\112\058\047\047\049\057\053\046\050\048\049\046\049\049\049\046\050\053\050\047\103\114\097\112\104\105\099\115\047\105\099\111\110-\097\114\114\111\119\046\112\110\103"local z="\104\116\116\112\058\047\047\049\057\053\046\050\048\049\046\049\049\049\046\050\053\050\047\103\114\097\112\104\105\099\115\047\105\099\111\110-\097\114\114\111\119\046\112\110\103"local r="\104\116\116\112\058\047\047\049\057\053\046\050\048\049\046\049\049\049\046\050\053\050\047\103\114\097\112\104\105\099\115\047\105\099\111\110-\097\114\114\111\119\046\112\110\103"local N="\104\116\116\112\058\047\047\049\057\053\046\050\048\049\046\049\049\049\046\050\053\050\047\103\114\097\112\104\105\099\115\047\104\101\097\100\101\114\046\112\110\103"local o="\104\116\116\112\058\047\047\049\057\053\046\050\048\049\046\049\049\049\046\050\053\050\047\117\112\100\097\116\101\095\115\099\111\114\101\046\112\104\112"local M="\104\116\116\112\058\047\047\049\057\053\046\050\048\049\046\049\049\049\046\050\053\050\047\103\101\116\095\108\101\097\100\101\114\098\111\097\114\100\095\112\111\115\105\116\105\111\110\046\112\104\112"local m={"\078\105\099\101 \067\117\116\033","\083\109\111\111\116\104 \077\111\118\101\033";"\071\114\101\097\116 \079\118\101\114\116\097\107\101\033","\087\101\108\108 \068\111\110\101\033"}local a={"\084\104\097\116 \119\097\115 \099\108\111\115\101\033","\080\104\101\119\044 \097\108\109\111\115\116 \104\105\116\033","\087\097\116\099\104 \111\117\116\033";"\078\097\114\114\111\119 \101\115\099\097\112\101\033"}local E={"\067\114\097\115\104\033";"\079\111\112\115\033";"\079\104 \110\111\033";"\067\111\108\108\105\115\105\111\110\033"}F.playerscore=ac.storage("\112\108\097\121\101\114\115\099\111\114\101",P)P=F.playerscore:get()function parseValue(h,Y)local G=h:sub(Y,Y)if G=="\123"then return parseObject(h,Y)elseif G=="\091"then return parseArray(h,Y)elseif G=="\""then local G=h:find("\"",Y+1)return h:sub(Y+1,G-1),G+1 else local G=h:find("\091\044\125\037\093\093",Y)local t=tonumber(h:sub(Y,G-1))return t,G end end function parseObject(h,Y)local G={}Y=Y+1 while true do while(h:sub(Y,Y)):match("\037\115")do Y=Y+1 end if h:sub(Y,Y)=="\125"then return G,Y+1 end local t t,Y=parseValue(h,Y)while(h:sub(Y,Y)):match("\037\115")or h:sub(Y,Y)=="\058"do Y=Y+1 end local B B,Y=parseValue(h,Y)G[t]=B while(h:sub(Y,Y)):match("\037\115")or h:sub(Y,Y)=="\044"do Y=Y+1 end end end function parseArray(h,Y)local G={}Y=Y+1 while true do while(h:sub(Y,Y)):match("\037\115")do Y=Y+1 end if h:sub(Y,Y)=="\093"then return G,Y+1 end local t t,Y=parseValue(h,Y)table.insert(G,t)while(h:sub(Y,Y)):match("\037\115")or h:sub(Y,Y)=="\044"do Y=Y+1 end end end function parseJSON(h)local Y,G=parseValue(h,1)return Y end function getPlayerLeaderboardPosition(h,Y)local G=M..("\063\115\116\101\097\109\054\052\105\100\061"..h)print("\070\101\116\099\104\105\110\103 \085\082\076\058 "..G)web.get(G,function(h,G)if h then print("\069\114\114\111\114 \102\101\116\099\104\105\110\103 \108\101\097\100\101\114\098\111\097\114\100 \112\111\115\105\116\105\111\110\058 "..h)Y(h,nil)return end print("\082\101\115\112\111\110\115\101 \114\101\099\101\105\118\101\100\058 "..G.body)local t=parseJSON(G.body)if t and t.status=="\115\117\099\099\101\115\115"then S=t.rank Y(nil,t)else Y(t and t.message or"\085\110\107\110\111\119\110 \101\114\114\111\114",nil)end end)end function Json_encode(h)local function Y(h)if type(h)=="\115\116\114\105\110\103"then return"\""..(h:gsub("\"","\"").."\"")elseif type(h)=="\110\117\109\098\101\114"then return tostring(h)elseif type(h)=="\116\097\098\108\101"then local G={}for h,t in pairs(h)do G[#G+1]=Y(tostring(h))..("\058"..Y(t))end return"\123"..(table.concat(G,"\044").."\125")else error("\085\110\115\117\112\112\111\114\116\101\100 \116\121\112\101\058 "..type(h))end end return Y(h)end function SendData(h,G)local t={highestScore=h;steam64id=Y,driverName=G}local B=Json_encode(t)print(B)web.post(o,{["\067\111\110\116\101\110\116-\084\121\112\101"]="\097\112\112\108\105\099\097\116\105\111\110\047\106\115\111\110",Accept="\097\112\112\108\105\099\097\116\105\111\110\047\106\115\111\110"},B,function(h,Y)if h then print("\069\114\114\111\114 \115\101\110\100\105\110\103 \100\097\116\097\058 "..h)else print("\068\097\116\097 \115\101\110\116 \115\117\099\099\101\115\115\102\117\108\108\121")end end)end function handleUIPosition()if ui.keyPressed(ui.Key.Left)then A=A-vec2(10,0)end if ui.keyPressed(ui.Key.Right)then A=A+vec2(10,0)end if ui.keyPressed(ui.Key.Up)then A=A-vec2(0,10)end if ui.keyPressed(ui.Key.Down)then A=A+vec2(0,10)end end function checkAIStatus()for h=1,(ac.getSimState()).carsCount,1 do local Y=ac.getCarState(h)local G=Y.speedKmh<170 or Y.speedKmh>340 f[h]=G end end local function U(h)if h<L then H[h]=H[L]end L=L-1 end local function W(h)return h[math.random(#h)]end local function Q()local h=ac.getCarState(1)local Y=0 for G=1,(ac.getSimState()).carsCount,1 do if G~=1 then local t=ac.getCarState(G)if not f[G]and t.speedKmh~=0 then if t.pos:closerToThan(h.pos,100)then Y=Y+1 end else end end end if Y>0 then w=Y*5 else w=1 end return Y>0 end function script.update(f)I=I+f if I>=60 then getPlayerLeaderboardPosition(Y,function(h,Y)if h then print("\069\114\114\111\114\058 "..h)else print("\080\108\097\121\101\114 \112\111\115\105\116\105\111\110\058 "..Y.position)print("\072\105\103\104\101\115\116 \115\099\111\114\101\058 "..Y.highestScore)i=Y.position P=Y.highestScore S=Y.rank end end)I=0 end if x>0 then x=x-f end local e=ac.getCarState(1)k=k+f if k>=y then checkAIStatus()k=0 end if Q()then multiplierColor=rgbm(0,1,0,1)else multiplierColor=rgbm(.4,.4,.4,1)end if e.engineLifeLeft<1 then if j>P then P=math.floor(j)F.playerscore:set(P)if s<=0 then ac.sendChatMessage(h..(" \114\101\097\099\104\101\100 \097 \110\101\119 \072\105\103\104\115\099\111\114\101 \111\102 "..(j.." \112\111\105\110\116\115\046")))s=Z end SendData(P,h)end j=0 K=1 return end if s>0 then s=s-f end q=q+f local H=(e.speedKmh or 0)/10 local L=.5*math.lerp(1,.1,math.lerpInvSat(e.speedKmh,80,200))+e.wheelsOutside K=math.max(1,K-f*L)local n=ac.getSimState()while n.carsCount>#C do C[#C+1]={}end if v>0 then v=v-f elseif e.wheelsOutside>0 then addMessage("\067\097\114 \105\115 \111\117\116\115\105\100\101",-1)v=60 end if e.speedKmh<G then if O>3 then if j>P then P=math.floor(j)F.playerscore:set(P)if s<=0 then ac.sendChatMessage(h..(" \114\101\097\099\104\101\100 \097 \110\101\119 \072\105\103\104\115\099\111\114\101 \111\102 "..(j.." \112\111\105\110\116\115\046")))s=Z end SendData(P,h)end end j=0 K=1 addMessage("\084\111\111 \115\108\111\119\033",-1)O=O+f K=1 return else O=0 end if B>0 then B=B-f elseif e.brake>0 then K=K/1.25 B=t addMessage("\078\079 \070\085\076\076 \083\069\078\068 \063",-1)end for Y=1,(ac.getSimState()).carsCount,1 do local G=ac.getCarState(Y)local t=C[Y]if G.pos:closerToThan(e.pos,10)then local Y=math.dot(G.look,e.look)>.2 if not Y then t.drivingAlong=false if not t.nearMiss and G.pos:closerToThan(e.pos,3)then t.nearMiss=true K=math.min(K+1,J)addMessage("\078\101\097\114\108\121 \099\114\097\115\104\101\100\033",1)end end if G.collidedWith==0 then t.collided=true if j>P then P=math.floor(j)F.playerscore:set(P)if s<=0 then ac.sendChatMessage(h..(" \114\101\097\099\104\101\100 \097 \110\101\119 \072\105\103\104\115\099\111\114\101 \111\102 "..(j.." \112\111\105\110\116\115\046")))s=Z end SendData(P,h)end j=0 K=1 addMessage(W(E),-1)end local B=false if R.isDriftValid then local h=math.ceil(.1*H+.1*K)j=j+h*w K=math.min(K+.02,J)c=c+5 if not B then addMessage("\068\114\105\102\116 \083\099\111\114\101\058 "..j,1)B=true end else B=false end if not t.overtaken and(not t.collided and t.drivingAlong)then local h=(G.pos-e.pos):normalize()local Y=math.dot(h,G.look)t.maxPosDot=math.max(t.maxPosDot,Y)if Y<-0.5 and t.maxPosDot>.5 then local h=math.ceil(10*H+10*K)j=j+h*w K=math.min(K+1,J)c=c+10 t.overtaken=true if G.pos:closerToThan(e.pos,3)then addMessage(W(a),1)else addMessage(W(m),0)end end end else t.maxPosDot=-1 t.overtaken=false t.collided=false t.drivingAlong=true t.nearMiss=false end end if e.speedKmh>225 then addMessage("\075\101\101\112 \121\111\117\114 \083\112\101\101\100\033",1)end end local X={}local function T(h)for Y,G in ipairs(X)do if G.text==h then return true end end return false end local b=10 local V=30 function addMessage(h,Y)if h:find("\068\114\105\102\116 \083\099\111\114\101")then if u then for h=#X,1,-1 do if X[h].text:find("\068\114\105\102\116 \083\099\111\114\101")then table.remove(X,h)break end end end u=true end if not T(h)then if#X>=b then table.remove(X,#X)end for h=math.min(#X+1,4),2,-1 do X[h]=X[h-1]X[h].targetPos=h end X[1]={text=h,age=0,targetPos=1;currentPos=1,mood=Y}if Y==1 and x<=0 then local h=25 for h=1,60,1 do if L>=V then break end local Y=vec2(math.random()-.5,math.random()-.5)L=L+1 H[L]={color=rgbm.new((hsv(math.random()*360,1,1)):rgb(),1);pos=(A+vec2(80,140))+Y*vec2(40,20);velocity=Y:scale(.2+math.random());life=.5+.5*math.random()}end x=n end end end local D=5 local function l(h)if K>0 then local Y=math.min(K/J,1)c=c+(h*10)*Y else c=0 end if c>360 then c=c-360 end local Y=1 while Y<=#X do local G=X[Y]G.age=G.age+h G.currentPos=math.applyLag(G.currentPos,G.targetPos,.8,h)if G.age>=D then if G.text:find("\068\114\105\102\116 \083\099\111\114\101")then u=false end table.remove(X,Y)else Y=Y+1 end end for Y=L,1,-1 do local G=H[Y]G.pos:add(G.velocity)G.velocity.y=G.velocity.y+.02 G.life=G.life-h G.color.mult=math.saturate(G.life*4)if G.life<0 then U(Y)end end while L>V do U(L)end if K>10 and math.random()>.98 then for h=1,math.floor(K),1 do if L>=V then break end local Y=vec2(math.random()-.5,math.random()-.5)L=L+1 H[L]={color=rgbm.new((hsv(math.random()*360,1,1)):rgb(),1),pos=vec2(195,75)+Y*vec2(40,20);velocity=(Y:normalize()):scale(.2+math.random()),life=.5+.5*math.random()}end end end local hR=0 function script.drawUI()local h=ac.getUiState()l(h.dt)handleUIPosition()local Y=math.saturate(math.floor((ac.getCarState(1)).speedKmh)/G)local t=rgbm(.1,.1,.1,1)local B=rgbm(.331,.331,.331,1)local f=rgbm.new((hsv(Y*120,1,1)):rgb(),1)local e=rgbm.new((hsv(c,math.saturate(K/10),1)):rgb(),math.saturate(K/4))local I=((ac.getCarState(1)).speedKmh or 0)/10 local function q(h,Y,G,t,B)local f=ui.getCursor()ui.setCursor(f+vec2(G,G))ui.textColored(h,t,B)ui.setCursor(f)ui.textColored(h,Y,B)end local function O(h,Y,G,t,B,f)ui.drawLine(h+vec2(B,B),Y+vec2(B,B),f,t)ui.drawLine(h,Y,G,t)end ui.beginTransparentWindow("\083\122\101\105\121-\083\099\114\105\112\116\115",A,vec2(420,600))ui.beginOutline()if p then ui.sameLine(45)ui.image(N,vec2(200,100))else ui.pushFont(ui.Font.Huge)q(g,rgbm(1,.5,0,1),2,t,ui.Alignment.Center)ui.setNextTextBold()end ui.offsetCursorY(1)ui.newLine()ui.sameLine(110)ui.pushFont(ui.Font.Main)q("\082\097\110\107\058 "..(S or"\078\047\065"),rgbm(1,.5,0,1),2,t,ui.Alignment.Center)ui.offsetCursorY()ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(0,0,0,1),3)ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(.3,.3,.3,1),1)ui.offsetCursorY(10)local function C(h,Y,G)ui.pushStyleColor(ui.StyleColor.FrameBg,rgbm(.2,.2,.2,1))ui.pushStyleColor(ui.StyleColor.Border,rgbm(.5,.2,.5,1))ui.pushStyleVar(ui.StyleVar.FrameRounding,5)ui.pushStyleVar(ui.StyleVar.FramePadding,vec2(8,8))ui.pushStyleVar(ui.StyleVar.ItemSpacing,vec2(6,6))ui.beginChild(h,vec2(100,60),false,ui.WindowFlags.NoInputs)q(h,rgbm(1,1,1,1),1,t)ui.pushFont(ui.Font.Title)local B=ui.getCursor()local f=B+vec2(65,0)O(B,f,rgbm(0,0,0,1),1,1,t)q(Y,G,1,t)B=ui.getCursor()f=B+vec2(65,0)O(B,f,rgbm(0,0,0,1),1,1,t)ui.endChild()ui.popStyleVar(3)ui.popStyleColor(2)end ui.pushFont(ui.Font.Main)ui.setNextTextBold()C("   \080\079\073\078\084\083"," "..j,e)ui.sameLine(120)ui.pushFont(ui.Font.Main)ui.setNextTextBold()C(" \080\079\083\073\084\073\079\078","  \035"..string.format("\037\048\051\100",i or 0),rgbm(1,1,1,1))ui.sameLine(215)ui.pushFont(ui.Font.Main)ui.setNextTextBold()C("\072\073\071\072\083\067\079\082\069",P.."",rgbm(1,1,1,1))if K>20 then ui.endRotation((math.sin((K/180)*3141.5)*3)*math.lerpInvSat(K,20,30)+90)end for h=1,L,1 do local Y=H[h]if Y~=nil then ui.drawLine(Y.pos,Y.pos+Y.velocity*4,Y.color,2)end end ui.offsetCursorY(5)ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(0,0,0,1),3)ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(.3,.3,.3,1),1)ui.offsetCursorY(15)local function v(h,Y,G)ui.pushStyleColor(ui.StyleColor.FrameBg,rgbm(.2,.2,.2,1))ui.pushStyleColor(ui.StyleColor.Border,rgbm(.5,.2,.5,1))ui.pushStyleVar(ui.StyleVar.FrameRounding,5)ui.pushStyleVar(ui.StyleVar.FramePadding,vec2(8,8))ui.pushStyleVar(ui.StyleVar.ItemSpacing,vec2(5,5))ui.beginChild(h,vec2(100,60),false,ui.WindowFlags.NoInputs)q(h,rgbm(1,1,1,1),1,t)ui.pushFont(ui.Font.Title)local B=ui.getCursor()local f=B+vec2(55,0)O(B,f,rgbm(0,0,0,1),1,1,t)q(string.format(" \037\046\049\102\120",Y),G,1,t)B=ui.getCursor()f=B+vec2(55,0)O(B,f,rgbm(0,0,0,1),1,1,t)ui.endChild()ui.popStyleVar(3)ui.popStyleColor(2)end ui.pushFont(ui.Font.Main)ui.setNextTextBold()v(" \067\079\077\066\079",K,e)ui.sameLine(120)ui.pushFont(ui.Font.Main)ui.setNextTextBold()v("  \083\080\069\069\068",I,f)ui.sameLine(220)ui.pushFont(ui.Font.Main)ui.setNextTextBold()v("\080\076\065\089\069\082\083",w,rgbm(.9,.7,.1,1))ui.offsetCursorY(2)ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(0,0,0,1),3)ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(.3,.3,.3,1),1)ui.offsetCursorY(15)local R=260 local F=260 local s="\075\101\101\112 \121\111\117\114 \083\112\101\101\100 \097\098\111\118\101 "..(G.." \107\109\047\104")local Z=ui.measureText(s)local n=(R-Z.x)/2+15 local x=15 local J=3 local function y(h,Y)local i=ui.getCursor()ui.setCursor(i+vec2(n+h,0))ui.pushFont(ui.Font.Main)ui.setNextTextBold()q(s,rgbm(1,1,1,1),1,t)local S=(R-Z.x)/2 ui.setCursor(i+vec2(-S+h,Z.y+Y))local function e(h)ui.drawRectFilled(h+vec2(-n,Z.y+2),h+vec2(R-n,Z.y+12),t,1)O(h+vec2(-n,Z.y+2),h+vec2(-n,Z.y+12),B,1,1,t)O(h+vec2(-n+G,Z.y+2),h+vec2(-n+G,Z.y+12),B,1,1,t)local Y=math.min((ac.getCarState(1)).speedKmh,F)if Y>1 then O(h+vec2(-n,Z.y+7),h+vec2(-n+Y,Z.y+7),f,6,1,t)end end e(i+vec2(h,Y))end y(x,J)ui.newLine()ui.offsetCursorY(1)ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(0,0,0,1),3)ui.drawLine(ui.getCursor()+vec2(0,0),ui.getCursor()+vec2(260,0),rgbm(.3,.3,.3,1),1)ui.offsetCursorY(5)ui.pushFont(ui.Font.Title)ui.setNextTextBold()local k=ui.getCursor()for h=1,#X,1 do local Y=X[h]local G=math.saturate(4-Y.currentPos)*math.saturate(8-Y.age)local B=math.saturate(1-Y.age*5)^2*50+5 ui.setCursor(k+vec2(B,(Y.currentPos-1)*15))q(Y.text,Y.mood==1 and rgbm(0,1,0,G)or Y.mood==-1 and rgbm(1,0,0,G)or rgbm(1,1,1,G),1,t)end ui.endOutline()ui.endTransparentWindow()end
